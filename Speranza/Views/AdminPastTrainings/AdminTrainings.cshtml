@model Speranza.Models.AdminTrainingsModel
@{
    ViewBag.Title = "Správa minulých tréningov";
    Layout = "~/Views/Layout.cshtml";
}

<div class="container calendar-container">
    <div id="messageBox" style="display:none;" class="alert alert-success" role="alert"></div>
    <div id="messageBoxWarning" style="display:none;" class="alert alert-warning" role="alert"></div>
</div>

<div class="container">
    <h2 class="userProfileLabel">
        Správa minulých tréningov
          </h2>
    <div class="row">
        <div class="form-inline form-group paginationSettings col-6">
            @Html.Label("Počet tréningov na stránku:", new {@class = "control-label"})
            <div style="margin-left: 10px">
                <select id="pageSize" class="form-control selcls">
                    @foreach (var size in new[] {20, 40, 50, 100})
                    {
                        <option @(Model.PageSize == size ? "selected=\"selected\"" : "")>@size</option>
                    }
                </select>
            </div>
        </div>

        <nav aria-label="Page navigation" class="col-6 paginationSettings">
            <ul class="pagination float-right">
                @if (Model.PageNumber == 1)
                {
                    <li id="liPrev" class="disabled">
                        <a class="liPage" data-page="@(Model.PageNumber - 1)" href="#" aria-label="Previous">
                            <span aria-hidden="true">&laquo;</span>
                        </a>
                    </li>
                }
                else
                {
                    <li id="liPrev">
                        <a class="liPage" data-page="@(Model.PageNumber - 1)" href="#" aria-label="Previous">
                            <span aria-hidden="true">&laquo;</span>
                        </a>
                    </li>
                }


                @for (int i = 1; i <= Model.PagesCount; i++)
                {
                    if (i == Model.PageNumber)
                    {
                        <li id="liPage-@i" class="active"><a class="liPage" data-page="@i" href="#">@i</a></li>
                    }
                    else
                    {
                        <li id="liPage-@i"><a class="liPage" data-page="@i" href="#">@i</a></li>
                    }
                }
                @if (Model.PageNumber == Model.PagesCount)
                {
                    <li id="liNext" class="disabled">
                        <a class="liPage" data-page="@(Model.PageNumber + 1)" href="#" aria-label="Next">
                            <span aria-hidden="true">&raquo;</span>
                        </a>
                    </li>
                }
                else
                {
                    <li id="liNext">
                        <a class="liPage" data-page="@(Model.PageNumber + 1)" href="#" aria-label="Next">
                            <span aria-hidden="true">&raquo;</span>
                        </a>
                    </li>
                }

            </ul>

        </nav>
    </div>
    <div id="loader" class="loader"></div>

<div class="table-responsive">
    <table class="table table-striped" id="TrainingsTable">
        <thead>
        <tr>
            <th class="col-xs-1">Dátum</th>
            <th class="col-xs-1">Čas</th>
            <th class="col-xs-3">Popis</th>
            <th class="col-xs-2">Tréner</th>
            <th class="col-xs-1">Prihlásení</th>
            <th class="col-xs-1">Kapacita</th>
            <th>Akcia</th>
        </tr>
        </thead>
        <tbody>
        @foreach (var item in Model.Trainings.OrderByDescending(s => s.Time))
        {
            <tr id="@item.ID-Row">
                <td id="@item.ID-date">@item.Time.ToString("dd.MM.yyyy")</td>
                <td id="@item.ID-time">@item.Time.ToString("HH:mm")</td>
                <td>@item.Description</td>
                <td>@item.Trainer</td>
                <td>
                    <span id="@item.ID-RegisteredNumber">@item.RegisteredNumber</span>
                    <span class="trainingsDetails" style="cursor:pointer" data-training="@item.ID">Detail</span>
                </td>
                <td>@item.Capacity</td>
                <td></td>
            </tr>
        }
        </tbody>
    </table>
    </div>
</div>


@Html.Partial("TrainingDetails")

@section scripts {
    <script>
        $(function () {
            $("#loader").hide();
        })

        $(function () {

            $(".liPage").click(function () {
                var self = $(this);
                if (self.parent().hasClass("disabled")) {
                    return;
                }
                var size = $("#pageSize").val();
                var page = self.data("page");
                $("#loader").show();
                $.ajax({
                    //controller method
                    url: "ShowTrainingsPage",
                    //controller method parameter : trainingID
                    data: { page: page, size : size },
                    type: 'POST',
                    dataType: "html",
                    success: function (response) {
                        $("#TrainingsTable").html(response);
                        $("li.active").removeClass("active");
                        $("#liPage-" + page).addClass("active");
                        $("#liNext a").data("page", page + 1);
                        if (page ==@Model.PagesCount) {
                            $("#liNext").addClass("disabled");
                        }
                        else {
                            $("#liNext").removeClass("disabled");
            }
            $("#liPrev a").data("page", page - 1);
            if (page == 1) {
                $("#liPrev").addClass("disabled");
            }
            else {
                $("#liPrev").removeClass("disabled");
            }
                        $("#loader").hide();
                    }
                })

            })
        })

        $("#pageSize").change(function(){
            var self = $(this);
            var value = self.val();
            var url ='@Url.Action("AdminTrainings", "AdminPastTrainings", new { pageSize = -1 })';
            window.location.href = url.replace("-1",value);
        });
    </script>


    <script src="~/Scripts/AdminTrainings.js"></script>
    <script src="~/Scripts/jquery.tablesorter.min.js"></script>
}
