@model Speranza.Models.AdminTrainingsModel
@{
    ViewBag.Title = "Správa tréningov";
    Layout = "~/Views/Layout.cshtml";
}
<div class="container">
    <h2>
        Správa tréningov
        <button id="AddNewTraining" class="btn btn-warning"><span class="glyphicon glyphicon-plus"></span></button>
    </h2>
    
    <div id="messageBox" style="display:none;" class="alert alert-success" role="alert"></div>
    <div id="messageBoxWarning" style="display:none;" class="alert alert-warning" role="alert"></div>

    <table class="table table-striped table-hover">
        <thead>
            <tr>
                <th class="col-xs-1">Dátum</th>
                <th class="col-xs-1">Čas</th>
                <th class="col-xs-3">Popis</th>
                <th class="col-xs-2">Tréner</th>
                <th class="col-xs-1">Prihlásení</th>
                <th class="col-xs-1">Kapacita</th>
                <th>Akcia</th>
            </tr>
        </thead>
        @foreach (var item in Model.Trainings.OrderBy(s => s.Time))
        {
            <tr>
                <td id="@item.ID-date">@item.Time.ToString("dd.MM.yyyy")</td>
                <td id="@item.ID-time">@item.Time.ToString("HH:mm")</td>
                <td><input type="text" value="@item.Description" class="trainingDescription form-control input-sm" data-training="@item.ID" /></td>
                <td><input type="text" value="@item.Trainer" class="trainingTrainer form-control input-sm" data-training="@item.ID"/></td>
                <td>
                @item.RegisteredNumber
                <span class="label label-info trainingsDetails" style="cursor:pointer" data-training="@item.ID">Detail</span>
                </td>
                <td><input type="text" value="@item.Capacity" class="trainingCapacity form-control input-sm "data-training="@item.ID"/></td>
                <td>Zrušiť tréning</td>
            </tr>
        }
    </table>
</div>

<div class="modal fade" id="trainingDetailsModal" tabindex="-1" role="dialog">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title">Prihlásení na tréning <span id="modalTitleTraining"></span></h4>
            </div>
            <div class="modal-body">

            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Zatvoriť</button>
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
</div><!-- /.modal -->


<div class="modal fade" id="NewTraining" tabindex="-1" role="dialog">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title">Vytvoriť nový tréning</h4>
            </div>
            <div class="modal-body">


                <div class="form-group" id="TrainingDate">
                    @Html.Label("Dátum: ", new { @class = "control-label col-sm-3" })
                    <div class="input-group date col-sm-2">
                        <input type="text" class="form-control"><span class="input-group-addon"><i class="glyphicon glyphicon-th"></i></span>
                    </div>
                </div>




                <div class="form-group">
                    @Html.Label("Čas", new { @class = "control-label col-sm-3" })
                    <div class="input-group bootstrap-timepicker timepicker col-sm-2">
                        <input  id="TrainingTime" data-format="hh:mm" type="text" class="form-control"/>
                        <span class="input-group-addon">
                            <i class="glyphicon glyphicon-time">
                            </i>
                        </span>
                    </div>
                </div>

                    <div class="form-group">
                        @Html.Label("Tréner", new { @class = "control-label col-sm-3" })
                        <div class="col-sm-9">
                            @Html.TextBox("Trainer", new { @class = "form-control" })
                        </div>
                    </div>

                    <div class="form-group">
                        @Html.Label("Popis ", new { @class = "control-label col-sm-3" })
                        <div class="col-sm-9">
                            @Html.TextBox("Description", new { @class = "form-control" })
                        </div>
                    </div>

                    <button type="button" class="btn btn-default" data-dismiss="modal">Uložiť</button>

                </div>
           
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Zrušiť</button>
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
</div><!-- /.modal -->

@section scripts {
    <script>
        $(function () {
            $('.trainingDescription').change(function () {

                var self = $(this);
                var trainingID = self.data('training');
                //value z textboxu
                var value = self.prop('value');
                $.ajax({
                    url: "ChangeTrainingDescription",
                    data: { trainingID: trainingID, description: value },
                    type: 'POST',
                    dataType: "json",
                    success: function (response) {
                        if (response == 1)
                        {
                            $('#messageBoxWarning').hide();
                            $('#messageBox').html("Tréningu <b>" + $('#' + trainingID + "-date").html() + " " + $('#' + trainingID + "-time").html() + "</b> bol zmenený popis na: <b>" + value + "</b>");
                            $('#messageBox').show();
                        }

                    }
                });

            });
        });

        $(function () {
            $('.trainingTrainer').change(function () {

                var self = $(this);
                var trainingID = self.data('training');
                //value z textboxu
                var value = self.prop('value');
                $.ajax({
                    url: "ChangeTrainer",
                    data: { trainingID: trainingID, trainer: value },
                    type: 'POST',
                    dataType: "json",
                    success: function (response) {
                        if (response == 2)
                        {
                            $('#messageBoxWarning').hide();
                            $('#messageBox').html("Tréningu <b>" + $('#' + trainingID + "-date").html() + " " + $('#' + trainingID + "-time").html() + "</b> bol priradený nový tréner: <b>" + value + "</b>");
                            $('#messageBox').show();
                        }
                           
                    }
                });

            });
        });

        $(function () {
            $('.trainingCapacity').change(function () {

                var self = $(this);
                var trainingID = self.data('training');
                //value z textboxu
                var value = self.prop('value');
                $.ajax({
                    url: "ChangeTrainingCapacity",
                    data: { trainingID: trainingID, capacity: value },
                    type: 'POST',
                    dataType: "json",
                    success: function (response) {
                        if (response == 3) {
                            $('#messageBoxWarning').hide();
                            $('#messageBox').html("Kapacita tréningu <b>" + $('#' + trainingID + "-date").html() + " " + $('#' + trainingID + "-time").html() + "</b> bola zmenená na: <b>" + value + "</b>");
                            $('#messageBox').show();
                        }
                        else if(response == 4)
                        {
                            $('#messageBox').hide();
                            $('#messageBoxWarning').html("Kapacita tréningu nemôže byť menšia ako 0!");
                            $('#messageBoxWarning').show();
                        }

                      
                        }
                });

            });
        });

        $(function () {
            $('.trainingsDetails').click(function () {

                var self = $(this);
                var trainingID = self.data('training');
                $.ajax({
                    //controller method
                    url: "TrainingDetails",
                    //controller method parameter : trainingID
                    data: { trainingID: trainingID },
                    type: 'POST',
                    dataType: "html",
                    success: function (response) {
                        $('.modal-body').html(response);
                        $('#modalTitleTraining').html($('#' + trainingID + "-date").html() + " " + $('#' + trainingID + "-time").html());
                        $('#trainingDetailsModal').modal('show');
                    }
                });

            });
        });

        $(function () {
            $('#AddNewTraining').click(function () {
                $('#NewTraining').modal('show');

            });

        });

        $('#TrainingDate .input-group.date').datepicker({
            format: "dd.mm.yyyy",
            weekStart: 1,
            maxViewMode: 2,
            language: "sk",
            daysOfWeekHighlighted: "0,6",
            todayHighlight: true,
            todayBtn: "linked"
        });

     
        $('#TrainingTime .input-group.date').timepicker(
          );
    

    </script>
    }
