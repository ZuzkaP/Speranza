@using Speranza.Models.Interfaces;
@using Speranza.Views
@using Speranza.Models;
@model Speranza.Models.CalendarModel
@{
    ViewBag.Title = "Calendar";
    Layout = "~/Views/Layout.cshtml";
}

<div class="container">
    <h2>Rozpis tréningov</h2>

    @if (Model != null)
    {
        <p> @Html.Raw(ViewHelper.ShowMessageInView(Model.Message, Model.SignedUpOrSignedOffTraining))</p>
    }


    <table class="table table-bordered">
        <thead>
            <tr>
                <th></th>
                @for (int i = 6; i < 21; i++)
            {
                    <th>@i.ToString("00"):00</th>
                }

            </tr>
        </thead>
        @foreach (var day in Model.Days)
        {
            <tr>
                <td class="warning">
                    @ViewHelper.TranslateDayNames(day.DayName)
                <br />
                @day.Date
            </td>
            @for (int i = 6; i < 21; i++)
            {
                ITrainingModel training = day.Trainings.FirstOrDefault(r => r.Time.Hour == i);
                if (training != null)
                {
                    <td @(training.IsUserSignedUp ? Html.Raw("class=\"success\""): Html.Raw(""))>
                        @training.Description <br />
                        @training.Trainer <br />
                        @training.RegisteredNumber / @training.Capacity<br />

                        @if (training.IsUserSignedUp)
                        {
                            if (training.IsAllowedToSignOff)
                            {
                                @Html.ActionLink("Odhlásiť", "SignOff", "Calendar", new { id = training.ID }, null);
                            }
                        }
                        else
                        {
                            if (training.RegisteredNumber < training.Capacity && training.IsAllowedToSignUp)
                            {
                                @Html.ActionLink("Prihlásiť", "SignUp", "Calendar", new { id = training.ID }, null);
                            }
                        }


                    </td>
                }
                else
                {
                    <td></td>
                }

            }
        </tr>
        }

    </table>

</div>